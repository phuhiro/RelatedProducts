<script type="text/javascript" src="/javascripts/mustache.min.js"></script>
<script type="text/javascript">

    ShopifyApp.ready(function() {
        ShopifyApp.Bar.initialize({
            title: '<%= title %>',
            buttons: {
                primary: {
                    label: "Save",
                    message: 'bar_save',
                    callback: function(){document.getElementById('nrForm').submit()}
                },
            }
        });
        ShopifyApp.Bar.loadingOff();
    });

    $(document).ready(function(){
      $(".my_select_box").chosen({
        no_results_text: "Oops, nothing found!",
        width: "95%"
      });


    });
//     var QueryString = function () {
//         // This function is anonymous, is executed immediately and
//         // the return value is assigned to QueryString!
//         var query_string = {};
//         var query = window.location.search.substring(1);
//         var vars = query.split("&");
//         for (var i=0;i<vars.length;i++) {
//         var pair = vars[i].split("=");
//             // If first entry with this name
//         if (typeof query_string[pair[0]] === "undefined") {
//           query_string[pair[0]] = decodeURIComponent(pair[1]);
//             // If second entry with this name
//         } else if (typeof query_string[pair[0]] === "string") {
//           var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
//           query_string[pair[0]] = arr;
//             // If third or later entry with this name
//         } else {
//           query_string[pair[0]].push(decodeURIComponent(pair[1]));
//         }
//         }
//         return query_string;
//     }
//     var shopQuery = QueryString().shop.replace(".myshopify.com", "")
//           document.cookie = "shop="+shopQuery;
//           var cookies = document.cookie;
//           console.log(cookies)
//
//
//           function setCookie(cname, cvalue, exdays) {
//           var d = new Date();
//           d.setTime(d.getTime() + (exdays*24*60*60*1000));
//           var expires = "expires="+ d.toUTCString();
//           document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
//       }
//
//       setCookie("rpshop",shopQuery,600);
//       function getCookie(cname) {
//           var name = cname + "=";
//           var ca = document.cookie.split(';');
//           for(var i = 0; i <ca.length; i++) {
//               var c = ca[i];
//               while (c.charAt(0)==' ') {
//                   c = c.substring(1);
//               }
//               if (c.indexOf(name) == 0) {
//                   return c.substring(name.length,c.length);
//               }
//           }
//           return "";
//       }
//
//       var shopValue = getCookie("rpshop")
//
//
//
//     <% var stringPass =  JSON.stringify(numOfRelPass);
//   var parsedPass = JSON.parse(stringPass); %>
//     var newArr = <%-stringPass%>
//     var defaultNum = <%- defaultNum %>;
//     $('#defNumSelect > option').each(function() {
//         if (this.value == defaultNum) {
//             $(this).attr("selected", 'selected')
//         }
//     })
//     newArr.forEach(function(element) {
//         var numO = element.numOfRel;
//         // if (numO !== defaultNum) {
//         var optNumOfRel = element.productID + numO;
//         var removeDefault = element.productID + defaultNum;
//         $('#option' + removeDefault).removeAttr('selected')
//         $('#option' + optNumOfRel).attr('selected', 'selected')
//             // }
//     });
//
//
//
//     function changeProduct(inp){
//       console.log(inp.attr('forproduct'))
//       $.ajax({
//         type: "GET",
//         url: "http://localhost:3000/changeProduct?forproduct=" + inp.attr('forproduct') + "&product=" + inp.attr('productid') + "&shop=" + inp.attr('store') + "&oldproduct=" + inp.attr('oldproduct') + '&title=' + inp.attr('title') + "&order=" + inp.attr('order'),
//         contentType: "application/json; charset=utf-8",
//         async: true,
//         dataType: "json",
//         success: function (data, textStatus, jqXHR) {
//             console.log(data);
//
//           }
//         })
//     }
//
//     function getAll(inp, alsoBought){
//       $.ajax({
//         type: "GET",
//         // url: "http://localhost:3000/getAllProducts?shop=" + inp.attr("store"),
//         url: "http://localhost:3000/getAllProducts?shop=" + inp,
//
//         contentType: "application/json; charset=utf-8",
//         async: true,
//         dataType: "json",
//         success: function (data, textStatus, jqXHR) {
//
//             var template = $("#rpListAll").html();
//             var mObj = {
//               products: data,
//               alsoBought: alsoBought
//
//               // forproduct: inp.attr("forproduct"),
//               // store: inp.attr("store"),
//               // oldproduct: inp.attr("productid"),
//               // order: inp.attr('order')
//             }
//             console.log("getall next")
//             console.log(mObj)
//             $('.my_select_box').html(Mustache.render(template, mObj));
//             $('.listAllLink').on('click', function(){
//               changeProduct($(this))
//             })
//
//             $(".my_select_box").chosen({
//               no_results_text: "Oops, nothing found!",
//               width: "95%"
//             });
//
//           }
//         })
//     }
//
//     function showRPWindow(inp){
//       $('#rpWindow').css('left','50%');
//       $.ajax({
//         type: "GET",
//         url: "http://localhost:3000/getRP?shop=<%=shop%>&product="+inp.attr('forproduct'),
//         contentType: "application/json; charset=utf-8",
//         async: true,
//         dataType: "json",
//         success: function (data, textStatus, jqXHR) {
//
//            console.log(data)
//             var template = $("#rpWinMain").html();
//             var mObj = {title: [],
//             cStore: shopValue,
//           forproduct: inp.attr('forproduct')};
//
//             var p = 1;
//             data.products.every(function(element){
//               p += 1;
//               mObj.title.push(element);
//               return !(p > inp.attr('NOR'))
//             });
//             console.log(data);
//             console.log(mObj)
//             $('#rpOL').html(Mustache.render(template, mObj));
//             $('.changeProductLink').on('click', function(){
//               getAll($(this));
//             })
//
//             var template2 = $("#bpListAll").html();
//             $('#bpProductList').html(Mustache.render(template2, data));
//
//
//
//
//
//
//
//             getAll("test-store-1994-1994", data.alsoBought);
//
//
//
//
//           }
//         })
//     };
//
//     function closeRPWindow(){
//       $('#rpWindow').css('left','-50%');
//     }
//
//     $('.open-rp').on('click',function(event){
//       $('#bpProductList').html("");
//
//       showRPWindow($(this));
//       event.preventDefault();
//
//
//     })
//     $('.close-rpWindow').on('click',function(){
//       closeRPWindow();
//     })
//
//
//     $(document).ready(function(){
//     $("#filter").keyup(function(){
//
//         // Retrieve the input field text and reset the count to zero
//         var filter = $(this).val(), count = 0;
//
//         // Loop through the comment list
//         $("#insert-products .well").each(function(){
//
//             // If the list item does not contain the text phrase fade it out
//             if ($(this).find('p').text().search(new RegExp(filter, "i")) < 0) {
//                 $(this).fadeOut();
//
//             // Show the list item if the phrase matches and increase the count by 1
//             } else {
//                 $(this).show();
//                 count++;
//             }
//         });
//
//         // Update the count
//         var numberItems = count;
//         $("#filter-count").text("Number of Products = "+count);
//     });
// });
//
//
//
//
//

</script>
